<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>FluentModelBuilder by Grinderofl</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>FluentModelBuilder</h1>
        <h2>Fluently configure EntityFramework 7 DbContext</h2>
        <a href="https://github.com/Grinderofl/FluentModelBuilder" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p><strong>FluentModelBuilder</strong> provides an entry point for Entity Framework 7 Model customization programmatically, instead of using <code>DbSet</code> or <code>OnModelCreating</code> override. This gives the DbContext customization a more modular and automatic approach.</p>

<h3>
<a id="goals" class="anchor" href="#goals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Goals</h3>

<p><a href="https://github.com/aspnet/EntityFramework">Entity Framework 7</a> is a ground-up rework of Microsoft's ORM platform. Unfortunately, it also means all of the features previous EF's had will need to be re-implemented. That's a lot of work, understandably so, but sadly a whole lot of features are still missing. One of the biggest offenders is the ability to customize your backing model from anywhere else than your subclassed DbContext, where in EF6 and earlier, there were several means of doing this, currently there is only one officially supported way - building your model yourself, but it has the pitfall of not being considerate with the DbContext's <code>DbSet</code> properties.</p>

<p>Cue <strong>FluentModelBuilder</strong>: It adds a model convention which updates the <code>InternalModelBuilder</code> used by <code>ModelBuilder</code> in <code>OnModelCreating</code> method. FluentModelBuilder runs prior to all other configuration, so anything that is in <code>OnModelCreating</code> of a DbContext overrides convention-based configuration.</p>

<h1>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h1>

<p>Here are a couple of examples to show you it works:</p>

<h2>
<a id="example-1---dbcontext-with-specific-entities" class="anchor" href="#example-1---dbcontext-with-specific-entities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example 1 - DbContext with specific entities</h2>

<h3>
<a id="subclassing-dbcontext" class="anchor" href="#subclassing-dbcontext" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Subclassing DbContext</h3>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// ApplicationContext.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ApplicationContext</span> : <span class="pl-k">DbContext</span>
{
  <span class="pl-k">public</span> DbSet&lt;EntityOne&gt; <span class="pl-en">EntityOnes</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; } <span class="pl-c">// Available as both context.EntityOnes and context.Set&lt;EntityOne&gt;();</span>
  <span class="pl-k">public</span> DbSet&lt;EntityTwo&gt; <span class="pl-en">EntityTwos</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; } <span class="pl-c">// Available as both context.EntityTwos and context.Set&lt;EntityTwo&gt;();</span>

  <span class="pl-k">protected</span> <span class="pl-k">override</span> <span class="pl-k">void</span> <span class="pl-en">OnModelCreating</span>(<span class="pl-k">ModelBuilder</span> <span class="pl-smi">builder</span>)
  {
    <span class="pl-c">// Alternatively:</span>
    builder.Entity&lt;EntityThree&gt;(); <span class="pl-c">// Available as context.Set&lt;EntityThree&gt;();</span>
  }
}

<span class="pl-c">// Startup.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Startup</span>
{
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Configure</span>(<span class="pl-k">IServiceCollection</span> <span class="pl-smi">services</span>)
    {
        services.AddEntityFramework()
            .AddDbContext&lt;ApplicationContext&gt;(x =&gt; x.UseInMemoryDatabase())
            .AddInMemory();
    }
}</pre></div>

<h3>
<a id="fluentmodelbuilder-equivalent" class="anchor" href="#fluentmodelbuilder-equivalent" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FluentModelBuilder equivalent</h3>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// Startup.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Startup</span>
{
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Configure</span>(<span class="pl-k">IServiceCollection</span> <span class="pl-smi">services</span>)
    {
        services.AddEntityFramework()
            .AddDbContext&lt;DbCotnext&gt;(x =&gt; x.UseInMemoryDatabase())
            .AddInMemory();

        services.ConfigureEntityFramework(mappings =&gt;
            mappings.Add(From.Empty()
                .Override&lt;EntityOne&gt;()
                .Override&lt;EntityTwo&gt;()
                .Override&lt;EntityThree&gt;()));
    }
}</pre></div>

<h2>
<a id="example-2---dbcontext-with-discovered-entities" class="anchor" href="#example-2---dbcontext-with-discovered-entities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example 2 - DbContext with discovered entities</h2>

<h3>
<a id="subclassing-dbcontext-1" class="anchor" href="#subclassing-dbcontext-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Subclassing DbContext</h3>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// ApplicationContext.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ApplicationContext</span> : <span class="pl-k">DbContext</span>
{
    <span class="pl-k">protected</span> <span class="pl-k">override</span> <span class="pl-k">void</span> <span class="pl-en">OnModelCreating</span>(<span class="pl-k">ModelBuilder</span> <span class="pl-smi">builder</span>)
    {
        <span class="pl-k">var</span> types = <span class="pl-k">typeof</span> (ApplicationContext).GetTypeInfo()
                .Assembly.GetExportedTypes()
                .Where(x =&gt; x.GetTypeInfo().Namespace.EndsWith(<span class="pl-s"><span class="pl-pds">"</span>.Entities<span class="pl-pds">"</span></span>));
            <span class="pl-k">foreach</span> (<span class="pl-k">var</span> type <span class="pl-k">in</span> types)
                modelBuilder.Entity(type);
    }
}

<span class="pl-c">// Startup.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Startup</span>
{
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Configure</span>(<span class="pl-k">IServiceCollection</span> <span class="pl-smi">services</span>)
    {
        services.AddEntityFramework()
            .AddDbContext&lt;ApplicationContext&gt;(x =&gt; x.UseInMemoryDatabase())
            .AddInMemory();
    }
}</pre></div>

<h3>
<a id="fluentmodelbuilder-equivalent-1" class="anchor" href="#fluentmodelbuilder-equivalent-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>FluentModelBuilder equivalent</h3>

<div class="highlight highlight-source-cs"><pre><span class="pl-c">// Startup.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Startup</span>
{
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Configure</span>(<span class="pl-k">IServiceCollection</span> <span class="pl-smi">services</span>)
    {
    services.AddEntityFramework()
            .AddDbContext&lt;DbCotnext&gt;(x =&gt; x.UseInMemoryDatabase())
            .AddInMemory();
        services.ConfigureEntityFramework(mappings =&gt;
            mappings.Add(From.AssemblyOf&lt;Startup&gt;(<span class="pl-k">new</span> EntityConfiguration()))
    }
}

<span class="pl-c">// EntityConfiguration.cs</span>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">EntityConfiguration</span> : <span class="pl-k">DefaultEntityAutoConfiguration</span>
{
    <span class="pl-k">public</span> <span class="pl-k">override</span> <span class="pl-k">bool</span> <span class="pl-en">ShouldMap</span>(<span class="pl-k">Type</span> <span class="pl-smi">type</span>)
    {
        <span class="pl-k">return</span> type.GetTypeInfo().Namespace.EndsWith(<span class="pl-s"><span class="pl-pds">"</span>.Entities<span class="pl-pds">"</span></span>);
    }
}</pre></div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Grinderofl/FluentModelBuilder/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Grinderofl/FluentModelBuilder/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Grinderofl/FluentModelBuilder"></a> is maintained by <a href="https://github.com/Grinderofl">Grinderofl</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-69079635-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
